<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login — VEJA BAGAM</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    :root { --accent:#38d397; --primary:#03642c; --card-radius:14px; }
    html,body{height:100%;margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,#114b2a 0%, rgba(33,134,67,0.6) 60%), url('https://i.postimg.cc/fLLNZ3w1/Whats-App-Image-2025-08-21-at-18-08-59.jpg') center/cover no-repeat;}
    .center {min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;}
    .card-login {width:100%;max-width:520px;border-radius:var(--card-radius);box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden;background:rgba(255,255,255,0.98);}
    .card-header {background:linear-gradient(90deg,var(--primary),var(--accent));color:#fff;padding:20px 24px;}
    .brand {display:flex;gap:12px;align-items:center}
    .brand img{height:42px}
    .card-body{padding:26px}
    label {font-weight:600;color:#1f5b39}
    .btn-login{background:var(--accent);color:#fff;border:none}
    .small-note{font-size:.92rem;color:#666;margin-top:8px}
    .hint{font-size:.9rem;color:#999;margin-top:6px}
    .error{color:#b91c1c;font-weight:700;margin-top:8px}
    footer{margin-top:14px;text-align:center;color:#fff;font-size:.9rem}
    .muted-link{font-size:.88rem;color:#047562;text-decoration:underline;cursor:pointer}
  </style>
</head>
<body>
  <div class="center">
    <div class="card-login">
      <div class="card-header">
        <div class="brand">
          <img src="https://i.postimg.cc/NG3dNtxk/Vibra-logo.png" alt="logo">
          <div>
            <div style="font-family:'Montserrat',sans-serif;font-weight:800;font-size:1.25rem">VEJA BAGAM</div>
            <div style="opacity:.9;font-size:.92rem">Área restrita</div>
          </div>
        </div>
      </div>

      <div class="card-body">
        <form id="loginForm" autocomplete="off">
          <div class="mb-3">
            <label for="key">Chave de acesso</label>
            <input id="key" class="form-control" type="text" maxlength="4" minlength="4" pattern="[A-Za-z0-9]{4}" required autocomplete="off" />
          </div>
          <div class="mb-3">
            <label for="password">Senha</label>
            <input id="password" class="form-control" type="password" required autocomplete="current-password" />
          </div>
          <div class="d-flex justify-content-end align-items-center">
            <button class="btn btn-login px-4" type="submit">Entrar</button>
          </div>
          <div id="msg" class="hint"></div>
        </form>

        <div class="text-center mt-3">
          <div class="mb-2">Solicitar acesso:</div>
          <button class="btn btn-outline-primary mb-1" id="btnSolicitarGmail" type="button">Via Gmail</button>
          <button class="btn btn-outline-info mb-1" id="btnSolicitarOutlook" type="button">Via Outlook</button>
          <button class="btn btn-outline-secondary mb-1" id="btnSolicitarMailto" type="button">Outro Email</button>
        </div>
        <script>
        const assunto = encodeURIComponent('Solicitação de acesso — VEJA BAGAM');
        const corpo = encodeURIComponent('Olá,\n\nGostaria de solicitar acesso ao sistema VEJA BAGAM.\n\nMeu nome: \nMinha chave desejada: \n\nObrigado!');
        const email = 'bagam.vibra@gmail.com';

        document.getElementById('btnSolicitarGmail').onclick = function() {
          window.open(
            `https://mail.google.com/mail/?view=cm&fs=1&to=${email}&su=${assunto}&body=${corpo}`,
            '_blank'
          );
        };
        document.getElementById('btnSolicitarOutlook').onclick = function() {
          window.open(
            `https://outlook.live.com/mail/0/deeplink/compose?to=${email}&subject=${assunto}&body=${corpo}`,
            '_blank'
          );
        };
        document.getElementById('btnSolicitarMailto').onclick = function() {
          window.open(`mailto:${email}?subject=${assunto}&body=${corpo}`, '_self');
        };
        </script>
      </div>
    </div>
  </div>

  <footer>AW;Code • 2025</footer>

<script>
const SALT = 's@Lt-VB-2025!';

/* ACCOUNTS: agora usa chaveHash e não emailHash */
const ACCOUNTS = [
  { id: 'u1', name: 'Wenderson', chaveHash: 'be4a16cc770b2e81d82a0c794ecf50c665ce111e2982eabb0342c4e1ff534600', passwordHash: '60db0fb561225b6def0aae239a76d0ac1909da2f1bcbda2631b1b2cccff5b66c' },
  { id: 'u2', name: 'Ana Clezia', chaveHash: '02617a799f31f259653e504dfb29457c783fa7184e564fbdfe7a9920f5b45944', passwordHash: '9e2e76739122d5cba6d065242fff166e5acad83b01ceec87ca42f4b028585ffc' },
  { id: 'u3', name: 'Cleirton', chaveHash: 'a3ee7b29402a75a12d6cbaefd6a9201ea39064e38068b5f3dd6a6fcf9c7fbaff', passwordHash: '0233f5afc95e906d818f87bb20c93f67d530ce15c452ddcee799cc3a592b17f8' },
  { id: 'u3', name: 'Eduardo', chaveHash: '67e11fc3d3c047d13741640c30cbbef468befa0a1556e4a3ede422593750b362', passwordHash: 'd8ff9f8a9870b1531f60f0bd63d97817597a160ad60ddfa491b763255ba313eb' }
];

/* Helper para calcular SHA-256 hex (use no console para gerar hashes e colar em ACCOUNTS) */
async function sha256Hex(text) {
  const enc = new TextEncoder().encode(text);
  const hash = await crypto.subtle.digest('SHA-256', enc);
  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
}
async function computeHashes(chave, password) {
  const c = (chave||'').toUpperCase().trim();
  const chaveHash = await sha256Hex(c + SALT);
  const passwordHash = await sha256Hex(password + SALT);
  console.log('CHAVE HASH (cole no ACCOUNTS.chaveHash):', chaveHash);
  console.log('PASSWORD HASH (cole no ACCOUNTS.passwordHash):', passwordHash);
  return { chaveHash, passwordHash };
}

/* Session & brute-force basic protection */
const MAX_ATTEMPTS = 5;
const LOCK_MINUTES = 2;
function getAttempts() {
  const s = sessionStorage.getItem('vb_attempts');
  return s ? JSON.parse(s) : { count:0, lockedUntil:0 };
}
function setAttempts(obj){ sessionStorage.setItem('vb_attempts', JSON.stringify(obj)); }
function resetAttempts(){ sessionStorage.removeItem('vb_attempts'); }

function nowMs(){ return Date.now(); }

/* login flow */
const form = document.getElementById('loginForm');
const msg = document.getElementById('msg');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  msg.textContent = '';
  const st = getAttempts();
  if (st.lockedUntil && nowMs() < st.lockedUntil) {
    const sec = Math.ceil((st.lockedUntil - nowMs())/1000);
    msg.textContent = 'Conta temporariamente bloqueada. Tente novamente em ' + sec + 's.';
    msg.className = 'error';
    return;
  }

  const chave = document.getElementById('key').value.trim().toUpperCase();
  const password = document.getElementById('password').value;
  if (!chave || chave.length !== 4 || !password) {
    msg.textContent = 'Informe uma chave de 4 dígitos e a senha.';
    msg.className = 'error';
    return;
  }

  const chaveHash = await sha256Hex(chave + SALT);
  const passwordHash = await sha256Hex(password + SALT);

  const account = ACCOUNTS.find(a => a.chaveHash === chaveHash && a.passwordHash === passwordHash);

  if (!account) {
    // incrementar tentativas
    st.count = (st.count || 0) + 1;
    if (st.count >= MAX_ATTEMPTS) {
      st.lockedUntil = nowMs() + (LOCK_MINUTES * 60 * 1000);
      msg.textContent = 'Muitas tentativas falhas. Bloqueado por ' + LOCK_MINUTES + ' minutos.';
    } else {
      msg.textContent = 'Chave ou senha incorretos. Tentativas: ' + st.count + '/' + MAX_ATTEMPTS;
    }
    setAttempts(st);
    msg.className = 'error';
    return;
  }

  // sucesso
  resetAttempts();
  sessionStorage.setItem('vb_autenticado', 'ok');
  msg.className = '';
  msg.textContent = 'Autenticado. Redirecionando...';
  setTimeout(() => {
    window.location.href = 'https://bagam-v.github.io/veja-bagam/';
  }, 800);
});

/* Auto-login removido para exigir login sempre */
</script>
</body>
</html>
